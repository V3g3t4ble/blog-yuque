---
import { getCollection } from 'astro:content';
import { SiteConfig } from '../config';
import { getPostDate } from '../utils/date';

const posts = await getCollection('posts');

const totalPosts = posts.length;
const totalWords = posts.reduce((acc, post) => {
  // Simple word count estimation from markdown body
  const words = post.body.trim().split(/\s+/).length;
  return acc + words;
}, 0);

const lastUpdated = posts.length > 0 
  ? new Date(Math.max(...posts.map(p => getPostDate(p).getTime())))
  : new Date();

// Format bytes for "file size" simulation
const totalSizeKB = (posts.reduce((acc, post) => acc + post.body.length, 0) / 1024).toFixed(1);
---

<div class="mt-8 mb-8 font-mono">
    <div class="flex items-center gap-2 mb-2">
        <span class="text-green-500">âžœ</span>
        <span class="text-blue-400">{SiteConfig.prompt.directory}</span>
        <span class="text-gray-400">git:(</span>
        <span class={SiteConfig.prompt.branchColor}>{SiteConfig.prompt.branch}</span>
        <span class="text-gray-400">)</span>
        <span class="text-yellow-400">./scripts/stats.sh</span>
    </div>

    <div class="bg-zinc-900/50 p-4 rounded border border-zinc-800 text-sm">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <h3 class="text-zinc-500 uppercase tracking-wider text-xs font-bold mb-3 border-b border-zinc-800 pb-1">Overview</h3>
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-gray-400">Total Posts</span>
                        <span class="text-green-400 font-bold">{totalPosts}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Total Words</span>
                        <span class="text-green-400 font-bold">~{totalWords}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Content Size</span>
                        <span class="text-green-400 font-bold">{totalSizeKB} KB</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Last Updated</span>
                        <span class="text-blue-400">{lastUpdated.toISOString().split('T')[0]}</span>
                    </div>
                </div>
            </div>
            
            <div class="flex items-center justify-center text-zinc-700 text-xs italic">
                 // System Stats //
            </div>
        </div>
        
        <div class="mt-4 pt-3 border-t border-zinc-800 text-xs text-zinc-600 font-mono">
            <span class="mr-4">Permissions: drwxr-xr-x</span>
            <span>User: {SiteConfig.username}</span>
        </div>
    </div>
</div>
