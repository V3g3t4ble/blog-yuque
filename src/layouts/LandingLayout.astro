---
import { SiteConfig } from '../config';
import CryptoJS from 'crypto-js';
import { getAllPosts } from '../services/posts';

interface Props {
  title: string;
}

const { title } = Astro.props;
const base = import.meta.env.BASE_URL;
const homeHref = `${base}home`;
// const isLocked = /üîí|üîê|üîè/.test(title);
// const hasPassword = isLocked && !!SiteConfig.password;
const ctaText = 'ÁÇπÂáªËøõÂÖ•';
// const passwordHash = hasPassword ? CryptoJS.SHA256(SiteConfig.password).toString() : '';
const friendLinks = SiteConfig.friendLinks || [];

const posts = await getAllPosts();
const totalPosts = posts.length;
const safeFormatDate = (date?: Date | null) => (date ? date.toISOString().split('T')[0] : 'ÊöÇÊó†');
const updatedTimes = posts
  .map((p) => (p.data.updated || p.data.date)?.getTime())
  .filter((t): t is number => typeof t === 'number' && Number.isFinite(t));

const lastUpdatedAt = updatedTimes.length ? new Date(Math.max(...updatedTimes)) : null;
---

<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title} | {SiteConfig.title}</title>
    <meta name="description" content={SiteConfig.description} />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;700&display=swap" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;700&display=swap"></noscript>
    <style>
      :root {
        font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        color-scheme: light dark;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      body {
        --lp-accent-1: #0a84ff;
        --lp-accent-2: #34c759;
        --lp-bg: #f2f2f7;
        --lp-fg: rgba(28, 28, 30, 0.96);
        --lp-muted: rgba(60, 60, 67, 0.78);
        --lp-border: rgba(60, 60, 67, 0.18);
        --lp-border-soft: rgba(60, 60, 67, 0.12);
        --lp-glass: rgba(255, 255, 255, 0.46);
        --lp-glass-strong: rgba(255, 255, 255, 0.64);
        --lp-glass-opaque: rgba(255, 255, 255, 0.84);
        --lp-hover: rgba(0, 0, 0, 0.045);
        --lp-hover-strong: rgba(0, 0, 0, 0.075);
        --lp-highlight: rgba(255, 255, 255, 0.62);
        --lp-highlight-soft: rgba(255, 255, 255, 0.36);
        --lp-blur: 36px;
        --lp-saturate: 220%;
        --lp-shadow: 0 38px 132px rgba(0, 0, 0, 0.18);
        --lp-shadow-soft: 0 18px 64px rgba(0, 0, 0, 0.12);

        margin: 0;
        height: 100vh;
        background-color: var(--lp-bg);
        background-image:
          radial-gradient(1100px circle at 18% 22%, rgba(10, 132, 255, 0.32), transparent 58%),
          radial-gradient(900px circle at 78% 12%, rgba(175, 82, 222, 0.20), transparent 56%),
          radial-gradient(1100px circle at 84% 78%, rgba(52, 199, 89, 0.22), transparent 60%),
          repeating-linear-gradient(135deg, rgba(255, 255, 255, 0.06) 0 1px, rgba(255, 255, 255, 0) 1px 8px),
          linear-gradient(180deg, rgba(255, 255, 255, 0.76), rgba(255, 255, 255, 0));
        background-attachment: fixed;
        color: var(--lp-fg);
      }
      a { color: inherit; }
      .page {
        height: 100vh;
        display: flex;
        align-items: stretch;
      }
      .container {
        width: min(1120px, 100%);
        margin: 0 auto;
        padding: clamp(18px, 4vw, 44px);
        display: flex;
        align-items: stretch;
        flex: 1 1 auto;
      }
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        height: 40px;
        padding: 0 16px;
        border-radius: 999px;
        border: 1px solid var(--lp-border-soft);
        background: var(--lp-glass-opaque);
        text-decoration: none;
        font-weight: 700;
        font-size: 14px;
        color: var(--lp-fg);
        -webkit-backdrop-filter: saturate(var(--lp-saturate)) blur(calc(var(--lp-blur) - 10px));
        backdrop-filter: saturate(var(--lp-saturate)) blur(calc(var(--lp-blur) - 10px));
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.10), inset 0 1px 0 var(--lp-highlight-soft);
      }
      .btn.primary {
        border-color: rgba(10, 132, 255, 0.28);
        background: rgba(10, 132, 255, 0.92);
        color: #ffffff;
      }
      .btn.primary:hover { background: rgba(10, 132, 255, 0.98); }
      .btn.cta {
        font-family: 'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-weight: 800;
        letter-spacing: 0.02em;
      }
      .btn svg { opacity: 0.9; }
      .hero {
        flex: 1 1 auto;
        border: 1px solid var(--lp-border-soft);
        border-radius: 18px;
        padding: clamp(22px, 3.5vw, 48px);
        background: linear-gradient(180deg, var(--lp-glass-strong), var(--lp-glass));
        -webkit-backdrop-filter: saturate(var(--lp-saturate)) blur(var(--lp-blur));
        backdrop-filter: saturate(var(--lp-saturate)) blur(var(--lp-blur));
        box-shadow: var(--lp-shadow), inset 0 1px 0 var(--lp-highlight), inset 0 0 0 1px rgba(255, 255, 255, 0.22);
        min-height: calc(100vh - (clamp(18px, 4vw, 44px) * 2));
        display: flex;
        align-items: stretch;
      }
      .hero-grid {
        display: grid;
        grid-template-columns: 1.6fr 0.8fr;
        gap: 22px;
        align-items: stretch;
        width: 100%;
      }
      .hero-main {
        min-width: 0;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }
      .hero-side {
        display: flex;
        flex-direction: column;
        gap: 12px;
        height: 100%;
      }
      .side-card {
        border: 1px solid var(--lp-border-soft);
        border-radius: 14px;
        background: linear-gradient(180deg, var(--lp-glass-strong), var(--lp-glass));
        padding: 14px;
        -webkit-backdrop-filter: saturate(var(--lp-saturate)) blur(calc(var(--lp-blur) - 4px));
        backdrop-filter: saturate(var(--lp-saturate)) blur(calc(var(--lp-blur) - 4px));
        box-shadow: var(--lp-shadow-soft), inset 0 1px 0 var(--lp-highlight-soft), inset 0 0 0 1px rgba(255, 255, 255, 0.18);
      }
      .side-card.links {
        flex: 1 1 auto;
        display: flex;
        flex-direction: column;
        min-height: 0;
      }
      .side-title {
        font-size: 12px;
        font-weight: 900;
        letter-spacing: 0.10em;
        text-transform: uppercase;
        color: var(--lp-muted);
        margin-bottom: 10px;
        user-select: none;
      }
      .landing-stats-grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 10px 12px;
      }
      .landing-stat .k {
        font-size: 12px;
        color: var(--lp-muted);
        margin-bottom: 2px;
        font-weight: 700;
      }
      .landing-stat .v {
        font-size: 13px;
        font-weight: 800;
        color: var(--lp-fg);
        opacity: 0.86;
        font-family: 'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      }
      .status-item {
        margin-bottom: 10px;
      }
      .status-item.last {
        margin-bottom: 0;
      }
      .status-row {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 10px;
        font-size: 13px;
        font-weight: 800;
        color: var(--lp-fg);
        opacity: 0.86;
      }
      .status-val {
        font-family: 'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 12px;
        font-weight: 800;
        opacity: 0.85;
      }
      .status-bar {
        margin-top: 6px;
        height: 8px;
        border-radius: 999px;
        background: var(--lp-hover-strong);
        overflow: hidden;
      }
      .status-fill {
        height: 100%;
        border-radius: 999px;
        background: linear-gradient(90deg, rgba(10, 132, 255, 0.92), rgba(52, 199, 89, 0.88));
      }
      .status-ellipsis {
        font-family: 'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        color: var(--lp-muted);
        font-weight: 800;
        letter-spacing: 0.18em;
        margin-top: 2px;
      }
      .friend-links {
        display: flex;
        flex-direction: column;
        gap: 8px;
        flex: 1 1 auto;
        min-height: 0;
        overflow: auto;
      }
      .friend-link {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 4px 6px;
        border-radius: 10px;
        border: none;
        background: transparent;
        font-size: 13px;
        font-weight: 800;
        color: var(--lp-fg);
        opacity: 0.86;
        text-decoration: none;
      }
      .friend-link::before {
        content: '';
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: rgba(10, 132, 255, 0.70);
        flex: 0 0 auto;
      }
      .friend-link:hover {
        background: rgba(10, 132, 255, 0.12);
        color: var(--lp-fg);
        opacity: 1;
      }
      .friend-link:hover::before {
        background: rgba(10, 132, 255, 0.92);
      }
      .friend-link:focus-visible {
        outline: 4px solid rgba(10, 132, 255, 0.18);
        outline-offset: 2px;
      }
      .brand {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        text-decoration: none;
        font-weight: 900;
        letter-spacing: -0.03em;
        margin-bottom: 14px;
      }
      .brand-dot {
        width: 10px;
        height: 10px;
        border-radius: 999px;
        background: linear-gradient(135deg, rgba(10, 132, 255, 1), rgba(175, 82, 222, 0.95), rgba(52, 199, 89, 1));
      }
      .hero-title {
        font-size: clamp(34px, 4.2vw, 54px);
        line-height: 1.04;
        letter-spacing: -0.03em;
        margin: 0 0 10px;
        font-weight: 900;
      }
      .hero-desc {
        margin: 0;
        max-width: 74ch;
        color: var(--lp-muted);
        line-height: 1.7;
        font-size: 16px;
      }
      .hero-desc .en {
        display: inline-block;
        margin-top: 6px;
        font-size: 0.95em;
        opacity: 0.78;
      }
      .hero-cta {
        margin-top: 18px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }
      .hero-features {
        margin-top: 14px;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }
      .hero-chip {
        display: inline-flex;
        align-items: center;
        height: 26px;
        padding: 0 10px;
        border-radius: 999px;
        border: 1px solid var(--lp-border-soft);
        background: var(--lp-glass-opaque);
        font-size: 12px;
        font-weight: 700;
        color: var(--lp-fg);
        opacity: 0.84;
        user-select: none;
      }
      .hero-hint {
        margin-top: 10px;
        font-size: 13px;
        color: var(--lp-muted);
      }
      .landing-login.hidden,
      .landing-login-error.hidden {
        display: none;
      }
      .landing-login {
        position: fixed;
        inset: 0;
        z-index: 60;
        display: grid;
        place-items: center;
        font-family: 'Inter', system-ui, sans-serif;
      }
      .landing-login-backdrop {
        position: absolute;
        inset: 0;
        background: rgba(17, 24, 39, 0.20);
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
      }
      .landing-login-modal {
        position: relative;
        width: min(520px, calc(100vw - 48px));
        border-radius: 16px;
        background: linear-gradient(180deg, var(--lp-glass-strong), var(--lp-glass));
        border: 1px solid var(--lp-border);
        box-shadow: var(--lp-shadow);
        padding: 24px 22px 22px;
        -webkit-backdrop-filter: saturate(var(--lp-saturate)) blur(var(--lp-blur));
        backdrop-filter: saturate(var(--lp-saturate)) blur(var(--lp-blur));
      }
      .landing-login-title {
        font-size: 22px;
        font-weight: 900;
        letter-spacing: -0.02em;
        margin: 0 0 6px;
      }
      .landing-login-subtitle {
        margin: 0 0 14px;
        font-size: 13px;
        color: var(--lp-muted);
      }
      .landing-login-input {
        width: 100%;
        border-radius: 12px;
        border: 1px solid var(--lp-border);
        padding: 12px 14px;
        font-size: 14px;
        outline: none;
        color: var(--lp-fg);
        background: var(--lp-glass-opaque);
        -webkit-backdrop-filter: saturate(var(--lp-saturate)) blur(calc(var(--lp-blur) - 10px));
        backdrop-filter: saturate(var(--lp-saturate)) blur(calc(var(--lp-blur) - 10px));
      }
      .landing-login-input:focus {
        border-color: rgba(10, 132, 255, 0.65);
        box-shadow: 0 0 0 4px rgba(10, 132, 255, 0.16);
      }
      .landing-login-error {
        margin-top: 10px;
        font-size: 12px;
        color: #dc2626;
      }
      .landing-login-actions {
        margin-top: 14px;
        display: flex;
        gap: 10px;
        justify-content: flex-end;
      }
      .landing-login-btn {
        height: 40px;
        padding: 0 16px;
        border-radius: 999px;
        border: 1px solid rgba(10, 132, 255, 0.28);
        background: rgba(10, 132, 255, 0.92);
        color: #ffffff;
        font-weight: 800;
        cursor: pointer;
      }
      .landing-login-btn:hover {
        background: rgba(10, 132, 255, 0.98);
      }
      .landing-login-cancel {
        height: 40px;
        padding: 0 16px;
        border-radius: 999px;
        border: 1px solid var(--lp-border-soft);
        background: var(--lp-glass-opaque);
        color: var(--lp-fg);
        opacity: 0.86;
        font-weight: 800;
        cursor: pointer;
        -webkit-backdrop-filter: saturate(var(--lp-saturate)) blur(calc(var(--lp-blur) - 10px));
        backdrop-filter: saturate(var(--lp-saturate)) blur(calc(var(--lp-blur) - 10px));
      }
      @media (max-width: 800px) {
        .hero { min-height: calc(100vh - 36px); }
        .hero-grid {
          grid-template-columns: 1fr;
          gap: 16px;
        }
        .hero-main {
          justify-content: flex-start;
        }
      }

      @media (prefers-color-scheme: dark) {
        body {
          --lp-bg: #0b0c10;
          --lp-fg: rgba(255, 255, 255, 0.92);
          --lp-muted: rgba(235, 235, 245, 0.62);
          --lp-border: rgba(235, 235, 245, 0.18);
          --lp-border-soft: rgba(235, 235, 245, 0.12);
          --lp-glass: rgba(28, 28, 30, 0.58);
          --lp-glass-strong: rgba(28, 28, 30, 0.72);
          --lp-glass-opaque: rgba(28, 28, 30, 0.88);
          --lp-hover: rgba(255, 255, 255, 0.06);
          --lp-hover-strong: rgba(255, 255, 255, 0.10);
          --lp-highlight: rgba(255, 255, 255, 0.12);
          --lp-highlight-soft: rgba(255, 255, 255, 0.08);
          --lp-shadow: 0 28px 96px rgba(0, 0, 0, 0.58);
          --lp-shadow-soft: 0 16px 56px rgba(0, 0, 0, 0.44);
          background-color: var(--lp-bg);
          background-image:
            radial-gradient(1100px circle at 18% 22%, rgba(10, 132, 255, 0.34), transparent 58%),
            radial-gradient(900px circle at 78% 12%, rgba(191, 90, 242, 0.22), transparent 56%),
            radial-gradient(1100px circle at 84% 78%, rgba(52, 199, 89, 0.18), transparent 60%),
            repeating-linear-gradient(135deg, rgba(255, 255, 255, 0.06) 0 1px, rgba(255, 255, 255, 0) 1px 8px),
            linear-gradient(180deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0));
        }
      }

      @media (prefers-reduced-transparency: reduce) {
        body {
          --lp-glass: rgba(255, 255, 255, 0.92);
          --lp-glass-strong: rgba(255, 255, 255, 0.96);
          --lp-glass-opaque: rgba(255, 255, 255, 0.98);
        }
        .hero,
        .side-card,
        .btn,
        .landing-login-backdrop,
        .landing-login-modal,
        .landing-login-input,
        .landing-login-cancel {
          -webkit-backdrop-filter: none !important;
          backdrop-filter: none !important;
        }
      }
    </style>
  </head>
  <body>
    {/* {hasPassword ? (
      <div id="landing-auth-config" data-hash={passwordHash} data-home={homeHref} class="hidden"></div>
    ) : null} */}
    <main class="page">
      <div class="container">
        <section class="hero">
          <div class="hero-grid">
            <div class="hero-main">
              <a class="brand" href={base} aria-label="ÂõûÂà∞ËêΩÂú∞È°µ">
                <span class="brand-dot"></span>
                <span>{SiteConfig.title}</span>
              </a>
              <h1 class="hero-title">ËèúÈ∏üÊàêÈïøËÆ∞ÂΩï</h1>
              <p id="landing-daily" class="hero-desc">Âä†ËΩΩÊØèÊó•‰∏ÄË®Ä...</p>
              <div class="hero-features" aria-label="ÁâπÊÄß">
                <span class="hero-chip">‰ª£Á†ÅÂÆ°ËÆ°</span>
                <span class="hero-chip">Ê∏óÈÄèÊµãËØï</span>
                <span class="hero-chip">Captcha The Flag</span>
                <span class="hero-chip">ÂÆâÂÖ®Á†îÁ©∂</span>
                <span class="hero-chip">ÈÄÜÂêëÂ∑•Á®ã</span>
              </div>
              <div class="hero-cta">
                <a class="btn primary cta" href={homeHref} aria-label={ctaText} style="text-decoration:none">
                  {ctaText}
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M5 12h14"></path>
                    <path d="m12 5 7 7-7 7"></path>
                  </svg>
                </a>
              </div>
            </div>

            <aside class="hero-side" aria-label="‰æßËæπÊ†è">
              <div class="side-card" aria-label="ÊñáÁ´†ÁªüËÆ°">
                <div class="side-title">ÊñáÁ´†ÁªüËÆ°</div>
                <div class="landing-stats-grid">
                  <div class="landing-stat">
                    <div class="k">ÊñáÁ´†</div>
                    <div class="v">{totalPosts}</div>
                  </div>
                  <div class="landing-stat">
                    <div class="k">ÊúÄËøëÊõ¥Êñ∞</div>
                    <div class="v">{safeFormatDate(lastUpdatedAt)}</div>
                  </div>
                </div>
              </div>
              <div class="side-card" aria-label="‰∏™‰∫∫Áä∂ÊÄÅ">
                <div class="side-title">‰∏™‰∫∫Áä∂ÊÄÅ</div>
                <div class="status-item">
                  <div class="status-row">
                    <span>Â§ßÂ≠¶ÁîüÊ¥ª</span>
                    <span class="status-val">87.5%</span>
                  </div>
                  <div class="status-bar"><div class="status-fill" style="width:87.5%"></div></div>
                </div>
                <div class="status-item">
                  <div class="status-row">
                    <span>‰∫∫ÁîüËøõÂ∫¶</span>
                    <span class="status-val">25%</span>
                  </div>
                  <div class="status-bar"><div class="status-fill" style="width:25%"></div></div>
                </div>
                <div class="status-item">
                  <div class="status-row">
                    <span>Â≠¶‰π†ËøõÂ∫¶</span>
                    <span class="status-val">50%</span>
                  </div>
                  <div class="status-bar"><div class="status-fill" style="width:50%"></div></div>
                </div>
                <div class="status-item last">
                  <div class="status-row">
                    <span>ÊÅãÁà±ËøõÂ∫¶</span>
                    <span class="status-val">100%</span>
                  </div>
                  <div class="status-bar"><div class="status-fill" style="width:100%"></div></div>
                </div>
              </div>
              <div class="side-card links" aria-label="ÂèãÊÉÖÈìæÊé•">
                <div class="side-title">ÂèãÊÉÖÈìæÊé•</div>
                {friendLinks.length > 0 ? (
                  <div class="friend-links">
                    {friendLinks.map((l) => (
                      <a class="friend-link" href={l.href} target="_blank" rel="noreferrer">{l.label}</a>
                    ))}
                  </div>
                ) : (
                  <div class="hero-desc" style="font-size:13px;opacity:.75">ÊöÇÊó†</div>
                )}
              </div>
            </aside>
          </div>
          <!-- {hasPassword ? <div class="hero-hint">ÊèêÁ§∫ÔºöÁÇπÂáªËøõÂÖ•ÂêéÂú®Ê≠§È°µËæìÂÖ•ÂØÜÁ†Å</div> : null} -->
        </section>
      </div>
    </main>

    {/* {hasPassword ? (
      <div id="landing-login" class="landing-login hidden" aria-hidden="true">
        <div id="landing-login-backdrop" class="landing-login-backdrop"></div>
        <div class="landing-login-modal" role="dialog" aria-modal="true">
          <div class="landing-login-title">{SiteConfig.title}</div>
          <div class="landing-login-subtitle">ËØ∑ËæìÂÖ•ËÆøÈóÆÂØÜÁ†Å</div>
          <input id="landing-password" class="landing-login-input" type="password" autocomplete="off" />
          <div id="landing-login-error" class="landing-login-error hidden"></div>
          <div class="landing-login-actions">
            <button id="landing-login-cancel" class="landing-login-cancel" type="button">ÂèñÊ∂à</button>
            <button id="landing-login-btn" class="landing-login-btn" type="button">ÁôªÂΩï</button>
          </div>
        </div>
      </div>
    ) : null}

    {hasPassword ? (
      <script>
        import CryptoJS from 'crypto-js';

        const SESSION_KEY_TYPORA = 'typora_blog_auth';
        const SESSION_KEY_TERMINAL = 'terminal_blog_auth';

        const login = document.getElementById('landing-login');
        const backdrop = document.getElementById('landing-login-backdrop');
        const input = document.getElementById('landing-password');
        const btn = document.getElementById('landing-login-btn');
        const cancel = document.getElementById('landing-login-cancel');
        const errorEl = document.getElementById('landing-login-error');
        const enterBtn = document.getElementById('landing-enter');

        const isAuthed = () =>
          sessionStorage.getItem(SESSION_KEY_TYPORA) === 'true' ||
          sessionStorage.getItem(SESSION_KEY_TERMINAL) === 'true';

        const show = () => {
          if (!login) return;
          login.setAttribute('aria-hidden', 'false');
          login.classList.remove('hidden');
          if (input instanceof HTMLInputElement) {
            input.value = '';
            input.focus();
          }
          if (errorEl) {
            errorEl.textContent = '';
            errorEl.classList.add('hidden');
          }
        };

        const hide = () => {
          if (!login) return;
          login.setAttribute('aria-hidden', 'true');
          login.classList.add('hidden');
        };

        const validate = (pwd: string) => {
          const cfg = document.getElementById('landing-auth-config');
          const targetHash = cfg?.dataset.hash;
          if (!targetHash) return false;
          return CryptoJS.SHA256(pwd).toString() === targetHash;
        };

        const getHomeHref = () => {
          const cfg = document.getElementById('landing-auth-config');
          return cfg?.dataset.home || '/home';
        };

        const attempt = () => {
          if (!(input instanceof HTMLInputElement)) return;
          if (!errorEl) return;
          errorEl.textContent = '';
          errorEl.classList.add('hidden');
          const pwd = input.value || '';
          if (validate(pwd)) {
            sessionStorage.setItem(SESSION_KEY_TYPORA, 'true');
            sessionStorage.setItem(SESSION_KEY_TERMINAL, 'true');
            sessionStorage.setItem('terminal_blog_key', pwd);
            window.dispatchEvent(new CustomEvent('auth:success', { detail: { password: pwd } }));
            window.location.href = getHomeHref();
          } else {
            errorEl.textContent = 'ÂØÜÁ†ÅÈîôËØØ';
            errorEl.classList.remove('hidden');
          }
        };

        enterBtn?.addEventListener('click', () => {
          if (isAuthed()) window.location.href = getHomeHref();
          else show();
        });
        btn?.addEventListener('click', attempt);
        cancel?.addEventListener('click', hide);
        backdrop?.addEventListener('click', hide);
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') hide();
          if (e.key === 'Enter' && !(login?.classList.contains('hidden'))) attempt();
        });
      </script>
    ) : null} */}

    <script>
      const el = document.getElementById('landing-daily');
      if (el) {
        const safeText = (s: unknown) => (typeof s === 'string' ? s.trim() : '');

        const endpointJson = 'https://v1.hitokoto.cn/?encode=json';
        const endpointText = 'https://v1.hitokoto.cn/?encode=text';

        const render = (text: string) => {
          const value = safeText(text);
          if (!value) return false;
          el.textContent = value;
          return true;
        };

        const renderError = () => {
          el.textContent = 'ÊØèÊó•‰∏ÄË®ÄËé∑ÂèñÂ§±Ë¥•ÔºåÁÇπÂáªÈáçËØï';
          el.style.cursor = 'pointer';
        };

        const loadRemote = async () => {
          const controller = new AbortController();
          const t = window.setTimeout(() => controller.abort(), 8000);
          try {
            const nonce = Date.now();
            const resp = await fetch(`${endpointJson}&_=${nonce}`, { signal: controller.signal, cache: 'no-store' });
            if (!resp.ok) throw new Error(String(resp.status));
            const json = (await resp.json().catch(() => null)) as any;
            const text = safeText(json?.hitokoto);
            if (!render(text)) throw new Error('empty');
            el.style.cursor = '';
          } finally {
            window.clearTimeout(t);
          }
        };

        const loadRemoteTextFallback = async () => {
          const controller = new AbortController();
          const t = window.setTimeout(() => controller.abort(), 8000);
          try {
            const nonce = Date.now();
            const resp = await fetch(`${endpointText}&_=${nonce}`, { signal: controller.signal, cache: 'no-store' });
            if (!resp.ok) throw new Error(String(resp.status));
            const text = safeText(await resp.text());
            if (!render(text)) throw new Error('empty');
            el.style.cursor = '';
          } finally {
            window.clearTimeout(t);
          }
        };

        const onRetry = () => {
          el.removeEventListener('click', onRetry);
          el.style.cursor = '';
          el.textContent = 'Âä†ËΩΩÊØèÊó•‰∏ÄË®Ä...';
          loadRemote()
            .catch(() => loadRemoteTextFallback())
            .catch(() => {
              renderError();
              el.addEventListener('click', onRetry, { once: true });
            });
        };

        loadRemote()
          .catch(() => loadRemoteTextFallback())
          .catch(() => {
            renderError();
            el.addEventListener('click', onRetry, { once: true });
          });
      }
    </script>
  </body>
</html>
